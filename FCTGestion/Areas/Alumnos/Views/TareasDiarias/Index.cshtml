@model IEnumerable<FCTGestion.Models.TareaDiaria>
@{
    ViewData["Title"] = "Tareas por semana";
    Layout = "~/Views/Shared/_Layout.cshtml";

    DateTime fechaRef = (ViewBag.FechaReferencia as DateTime?) ?? DateTime.Today;
    DateTime semanaAnterior = fechaRef.AddDays(-7);
    DateTime semanaSiguiente = fechaRef.AddDays(7);
}
@if (TempData["MensajeTareaDiaria"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" id="alertaTemporal">
        @TempData["MensajeTareaDiaria"]
    </div>
}


<h2>Tareas del @ViewBag.SemanaInicio al @ViewBag.SemanaFin</h2>

<div class="mb-3">
    <a asp-action="Index" asp-route-fechaReferencia="@semanaAnterior.ToString("yyyy-MM-dd")" class="btn btn-outline-primary">
        ← Semana anterior
    </a>
    <a asp-action="Index" asp-route-fechaReferencia="@semanaSiguiente.ToString("yyyy-MM-dd")" class="btn btn-outline-primary">
        Semana siguiente →
    </a>
    <a asp-action="Index" class="btn btn-outline-secondary">
        ⟳ Semana actual
    </a>
</div>

<a asp-area="Alumnos" asp-controller="TareasDiarias" asp-action="Create" class="btn btn-success mb-3">
    ➕ Añadir Registro
</a>

<table class="table table-bordered table-striped">
    <thead class="table-primary">
        <tr>
            <th class="text-center">Fecha</th>
            <th class="text-center">Descripción</th>
            <th class="text-center">Horas</th>
            <th class="text-center">Estado</th>
            <th class="text-center">Validación</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var tarea in Model)
        {
            <tr>
                <td class ="text-center"> @tarea.Fecha.ToShortDateString() </td>
                <td class="text-center">@tarea.Descripcion</td>
                <td class="text-center">@tarea.Horas</td>
                <td class="text-center">@tarea.Estado</td>
                <td class="text-center">@(tarea.FechaValidacion?.ToShortDateString() ?? "Pendiente")</td>
                <td class="text-center">
                    @if (tarea.Estado == EstadoValidacion.Pendiente)
                    {
                        <form asp-action="Delete" asp-route-fecha="@tarea.Fecha.ToString("yyyy-MM-dd")" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar esta tarea?');" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm">
                                🗑️ Eliminar
                            </button>
                        </form>
                    }
                    else
                    {
                        <button class="btn btn-outline-danger btn-sm disabled">
                            Eliminar
                        </button>
                    }
                </td>

            </tr>
        }
    </tbody>
</table>
<script src="~/js/desvanecerAlerta.js"></script>

